[pytest]
# Pytest configuration for cuvis-ai-core

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths = tests

# Prevent pytest from searching parent/sibling directories
norecursedirs = .* build dist CVS _darcs {arch} *.egg venv .venv .git .hg .bzr .tox __pycache__ node_modules ..

# Output options
addopts =
    -v
    --strict-markers
    --tb=short
    --color=yes

# Markers for test categorization
markers =
    unit: Unit tests for individual components
    integration: Integration tests across multiple components
    grpc: Tests for gRPC services
    pipeline: Tests for pipeline functionality
    slow: Tests that take significant time to run
    gpu: Tests that require GPU hardware
    stress: Stress tests with large datasets or heavy computation
    requires_data: Tests requiring external data (Lentils dataset) or system dependencies (Graphviz)

# Coverage options (when using pytest-cov)
# Run with: uv run python -m pytest --cov=cuvis_ai_core tests/

# Logging
log_cli = false
log_cli_level = INFO

# Warning filters
filterwarnings =
    # Ignore PyTorch internal deprecation warnings for pin_memory device argument
    ignore::DeprecationWarning:torch.utils.data._utils.pin_memory
    # Ignore NumPy 2.0 __array__ copy keyword deprecation from cuvis SDK objects
    ignore:.*__array__.*copy.*:DeprecationWarning
    # Ignore PyTorch Lightning / PyTorch internal LeafSpec FutureWarning (fixed in future versions)
    ignore:.*isinstance.*LeafSpec.*is deprecated.*:FutureWarning
    # Ignore PyTorch Lightning tensorboardX removal info message
    ignore:.*tensorboardX.*has been removed.*:UserWarning:pytorch_lightning.trainer.connectors.logger_connector.logger_connector
    # Ignore DataLoader num_workers suggestions in tests (not relevant for test performance)
    ignore:.*does not have many workers.*:UserWarning:pytorch_lightning.trainer.connectors.data_connector
    # Ignore logging interval warnings in tests with small datasets
    ignore:.*number of training batches.*is smaller than the logging interval.*:UserWarning:pytorch_lightning.loops.fit_loop
    # Ignore GPU available warnings when intentionally using CPU for benchmarking
    ignore:.*GPU available but not used.*:UserWarning:pytorch_lightning.trainer.setup

# Asyncio configuration
asyncio_mode = auto

# Minimum Python version
minversion = 7.0
